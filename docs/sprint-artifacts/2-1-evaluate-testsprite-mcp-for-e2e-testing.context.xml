<story-context id="2-1-evaluate-testsprite-mcp-for-e2e-testing" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>1</storyId>
    <title>Evaluate TestSprite MCP for E2E Testing</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-1-evaluate-testsprite-mcp-for-e2e-testing.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>development team evaluating testing tools</asA>
    <iWant>trial TestSprite MCP with the health check flow</iWant>
    <soThat>I can make an informed decision about our E2E testing approach</soThat>
    <tasks>
      <task id="1" ac="1">Research TestSprite MCP
        <subtask id="1.1">Search for TestSprite MCP documentation and integration requirements</subtask>
        <subtask id="1.2">Identify prerequisites (account, API keys, installation)</subtask>
        <subtask id="1.3">Document TestSprite capabilities and limitations</subtask>
        <subtask id="1.4">Assess compatibility with Nx monorepo structure</subtask>
      </task>
      <task id="2" ac="1">Configure TestSprite Integration
        <subtask id="2.1">Install TestSprite MCP (if available/accessible)</subtask>
        <subtask id="2.2">Configure connection settings</subtask>
        <subtask id="2.3">Verify basic connectivity</subtask>
        <subtask id="2.4">Document any access issues or blockers encountered</subtask>
      </task>
      <task id="3" ac="1,2">Create Test Scenarios for Health Check Flow
        <subtask id="3.1">Define test scenarios matching existing Playwright tests</subtask>
        <subtask id="3.2">Execute scenarios via TestSprite</subtask>
        <subtask id="3.3">Record execution results and any issues</subtask>
      </task>
      <task id="4" ac="2">Compare with Existing Playwright Setup
        <subtask id="4.1">Run equivalent Playwright tests from apps/web-e2e/src/</subtask>
        <subtask id="4.2">Compare metrics: setup, speed, debugging, CI integration</subtask>
        <subtask id="4.3">Create comparison matrix</subtask>
      </task>
      <task id="5" ac="3">Document Findings
        <subtask id="5.1">Create evaluation summary with comparison matrix</subtask>
        <subtask id="5.2">List pros/cons for each approach</subtask>
        <subtask id="5.3">Identify any hybrid approach possibilities</subtask>
        <subtask id="5.4">Prepare recommendation for Story 2.2 decision</subtask>
        <subtask id="5.5">Save findings to docs/architecture-decisions.md</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">
      <given>The walking skeleton is running (server + web)</given>
      <when>I configure TestSprite MCP integration</when>
      <then>I can execute test scenarios against the /health page</then>
    </criterion>
    <criterion id="AC2">
      <given>TestSprite is configured</given>
      <when>I run test scenarios</when>
      <then>I can compare the experience with native Playwright setup</then>
    </criterion>
    <criterion id="AC3">
      <given>Evaluation is complete</given>
      <when>I document findings</when>
      <then>Documentation includes: setup complexity, execution speed, debugging experience, CI integration</then>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Technology Stack Details</section>
        <snippet>E2E Testing: Playwright 1.56. Test location: apps/web-e2e/src/*.spec.ts. Configuration: apps/web-e2e/playwright.config.ts</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Quality Gates</section>
        <snippet>CI runs E2E as part of: pnpm exec nx run-many -t lint test build typecheck e2e. Pre-commit does NOT run E2E.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>PRD</title>
        <section>FR13-FR15</section>
        <snippet>Quality and governance requirements including comprehensive testing with Jest and Playwright, CI/CD pipelines, and TDD adoption.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epics</title>
        <section>Epic 2 - Story 2.1</section>
        <snippet>Evaluate TestSprite MCP with health check flow to make informed E2E testing approach decision.</snippet>
      </doc>
    </docs>

    <code>
      <file>
        <path>apps/web-e2e/playwright.config.ts</path>
        <kind>configuration</kind>
        <symbol>defineConfig</symbol>
        <lines>1-70</lines>
        <reason>Current Playwright configuration to compare against TestSprite. Uses nxE2EPreset, baseURL localhost:3000, webServer config.</reason>
      </file>
      <file>
        <path>apps/web-e2e/src/example.spec.ts</path>
        <kind>test</kind>
        <symbol>test('has title')</symbol>
        <lines>1-9</lines>
        <reason>Existing Playwright test pattern to replicate with TestSprite for comparison.</reason>
      </file>
      <file>
        <path>apps/web/src/app/health/page.tsx</path>
        <kind>component</kind>
        <symbol>HealthPage</symbol>
        <reason>Target page for E2E testing - displays health checks and ping button.</reason>
      </file>
      <file>
        <path>apps/server/src/routes/health.ts</path>
        <kind>route</kind>
        <symbol>healthRouter</symbol>
        <reason>API endpoints (GET /api/health, POST /api/health/ping) that E2E tests will exercise.</reason>
      </file>
      <file>
        <path>apps/server/src/routes/health.routes.spec.ts</path>
        <kind>test</kind>
        <symbol>integration tests</symbol>
        <reason>Existing integration test patterns for reference when comparing testing approaches.</reason>
      </file>
      <file>
        <path>apps/web-e2e/project.json</path>
        <kind>configuration</kind>
        <symbol>e2e target</symbol>
        <reason>Nx project configuration for E2E tests - run command: nx run web-e2e:e2e</reason>
      </file>
    </code>

    <dependencies>
      <node>
        <package name="@playwright/test" version="latest">Playwright test framework - current E2E solution</package>
        <package name="@nx/playwright" version="21.6.5">Nx Playwright plugin with preset configuration</package>
        <package name="next" version="~15.2.4">Next.js web framework - test target</package>
        <package name="express" version="^4.21.2">Express server - API test target</package>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint source="architecture.md">Tests must be co-located in src/ directory next to source files</constraint>
    <constraint source="architecture.md">E2E tests live in apps/web-e2e/src/*.spec.ts</constraint>
    <constraint source="architecture.md">CI pipeline runs E2E as part of nx run-many -t e2e</constraint>
    <constraint source="PRD.md">TDD methodology required - test before implementation</constraint>
    <constraint source="architecture.md">Use pnpm exec nx commands, never npm or yarn directly</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GET /api/health</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/health -> { data: HealthCheck[] }</signature>
      <path>apps/server/src/routes/health.ts</path>
    </interface>
    <interface>
      <name>POST /api/health/ping</name>
      <kind>REST endpoint</kind>
      <signature>POST /api/health/ping { message?: string } -> { data: HealthCheck }</signature>
      <path>apps/server/src/routes/health.ts</path>
    </interface>
    <interface>
      <name>Health Page</name>
      <kind>Web page</kind>
      <signature>http://localhost:3000/health - displays health checks with ping button</signature>
      <path>apps/web/src/app/health/page.tsx</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      E2E tests use Playwright with Nx preset configuration. Tests are located in apps/web-e2e/src/ with .spec.ts extension.
      Playwright config uses baseURL localhost:3000, webServer auto-starts the web app.
      Cross-browser testing enabled for chromium, firefox, webkit.
      Traces collected on first retry for debugging.
      Run command: pnpm exec nx run web-e2e:e2e
    </standards>
    <locations>
      <location>apps/web-e2e/src/*.spec.ts</location>
      <location>apps/web-e2e/test-output/</location>
    </locations>
    <ideas>
      <idea ac="AC1">Research TestSprite MCP installation and configuration requirements</idea>
      <idea ac="AC1">Attempt to execute test against /health page using TestSprite</idea>
      <idea ac="AC2">Run Playwright test: navigate to /health, verify list displays</idea>
      <idea ac="AC2">Run Playwright test: click Ping, verify new record appears</idea>
      <idea ac="AC2">Compare execution time between Playwright and TestSprite</idea>
      <idea ac="AC2">Compare debugging experience (error messages, screenshots, traces)</idea>
      <idea ac="AC3">Document comparison matrix with all evaluation criteria</idea>
      <idea ac="AC3">Note any blockers if TestSprite is not accessible</idea>
    </ideas>
  </tests>
</story-context>
