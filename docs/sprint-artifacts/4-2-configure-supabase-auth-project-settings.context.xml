<story-context v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>2</storyId>
    <title>Configure Supabase Auth Project Settings</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-04</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-2-configure-supabase-auth-project-settings.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>system administrator</asA>
    <iWant>Supabase Auth configured for the project</iWant>
    <soThat>authentication is ready for user implementation in Phase 2</soThat>
    <tasks>
      <task id="1">Access Supabase Auth Settings in dashboard</task>
      <task id="2">Enable Email/Password Authentication</task>
      <task id="3">Configure Email Confirmation (on/off decision)</task>
      <task id="4">Configure JWT Settings (expiration times)</task>
      <task id="5">Configure Redirect URLs (localhost dev, staging placeholder)</task>
      <task id="6">Document OAuth provider setup for future</task>
      <task id="7">Update docs/environment-setup.md</task>
      <task id="8">Document RLS interaction with auth</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">Email/password authentication is enabled in Supabase</criterion>
    <criterion id="AC2">Email confirmation, JWT expiration, and redirect URLs are configured with documented rationale</criterion>
    <criterion id="AC3">Settings are documented in docs/environment-setup.md</criterion>
    <criterion id="AC4">OAuth provider setup patterns are noted for future reference</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Integration Architecture</section>
        <snippet>Web/Mobile use Supabase SDK for authentication ONLY. All data flows through Express API.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Security Architecture</section>
        <snippet>RLS enabled on all tables (defense-in-depth). Service role key bypasses RLS for API server.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>PRD</title>
        <section>FR10</section>
        <snippet>Supabase client factories must support both browser contexts and server contexts with appropriate key usage.</snippet>
      </doc>
      <doc>
        <path>.env.example</path>
        <title>Environment Example</title>
        <section>Supabase Configuration</section>
        <snippet>Contains NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY templates</snippet>
      </doc>
    </docs>

    <code>
      <file>
        <path>packages/supabase-client/src/lib/client.ts</path>
        <kind>library</kind>
        <symbol>validateEnv</symbol>
        <reason>Shows expected environment variables for Supabase configuration</reason>
      </file>
    </code>

    <dependencies>
      <external>
        <service name="Supabase Dashboard" url="https://supabase.com/dashboard" />
        <service name="Supabase Auth" note="Dashboard → Authentication → Settings" />
      </external>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Configuration-only story - no code changes required</constraint>
    <constraint>Document all decisions with rationale</constraint>
    <constraint>Email confirmation disabled for dev recommended (faster testing)</constraint>
    <constraint>JWT expiration: recommend 1hr access token, 7d refresh token</constraint>
    <constraint>Redirect URLs must include localhost:3000 for web dev</constraint>
    <constraint>Do NOT commit actual credentials - document patterns only</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Supabase Auth Settings</name>
      <kind>Dashboard Configuration</kind>
      <signature>Dashboard → Authentication → Settings</signature>
      <path>https://supabase.com/dashboard/project/[PROJECT_ID]/auth/settings</path>
    </interface>
    <interface>
      <name>Redirect URL Configuration</name>
      <kind>Dashboard Configuration</kind>
      <signature>Dashboard → Authentication → URL Configuration</signature>
      <path>https://supabase.com/dashboard/project/[PROJECT_ID]/auth/url-configuration</path>
    </interface>
  </interfaces>

  <tests>
    <standards>No automated tests - this is a configuration story. Manual verification via Supabase dashboard and documentation review.</standards>
    <locations>
      <location>N/A - Configuration only</location>
    </locations>
    <ideas>
      <idea ac="AC1">Manual: Verify email provider shows "Enabled" in dashboard</idea>
      <idea ac="AC2">Manual: Verify JWT expiration values in Auth Settings</idea>
      <idea ac="AC2">Manual: Verify redirect URLs include localhost:3000</idea>
      <idea ac="AC3">Review: Check docs/environment-setup.md has complete Supabase Auth section</idea>
    </ideas>
  </tests>
</story-context>

